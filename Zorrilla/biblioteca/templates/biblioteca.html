{% extends 'base.html' %}
{% load static %}
{% block navbar %}
{% endblock navbar %}
{% block body %}
  <br></br>
  <center><h2>BIBLIOTECA</h2></center>
  <br><br>
<div class="container">
  <div class="row">
    <div class="">
      <input type="text"placeholder="Nombre del libro que desee buscar" id="myInput" onkeyup="myFunction()">
      <select id="filter_by">
          <option value=0>Libro</option>
          <option value=1>Descripción</option>
          <option value=2>Fecha</option>
      </select>
      </div>
      <div class="col-6">
      </div>
      <div class="col">
          <a class="btn btn-success" data-toggle="modal" data-target="#myModal" >Añadir libro</a>
      </div>
  </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-12">
        <h4></h4>
        <div class="table-responsive">


<table id="mytable" class="table table-hover">

      <thead>
        <th onclick="sortTable(0)">Libro</th>
        <th onclick="sortTable(1)">Descripción</th>
        <th onclick="sortTable(2)">Fecha</th>
        <th>Info</th>
        <th>Borrar</th>
        <th>Ver Libro</th>
      </thead>
      <tbody>
        {% for doc in documentos %}
            <tr>
            <td>{{doc.title}}</td>
            <td>{{doc.description}}</td>
            <td>{{doc.uploaded_at}}</td>
            <td><button class="btn btn-info" onclick="info_libro('{% url 'info_libro' doc.id %}', {{doc.id}})" id="info_book">
              <i style="font-size:15px" class="fa">&#xf013;</i></button></td>

            <td><button class="btn btn-danger" onclick="eliminar_libro('{% url 'eliminar_libro' doc.id %}', {{doc.id}})" id="delete_book">
              <i style="font-size:15px" class="fa">&#xf00d;</i></button></td>

            <td><a type="button" class="btn btn-outline-primary" href="{{ doc.document.url }}">Abrir</a></p></td>
            </tr>

        {% endfor %}
     </tbody>

</table>
<!-- The Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="font-weight-bold" id="Heading">Cargar Libro</h4>            
          <button type="button" class="close" data-dismiss="modal">X</button>
        </div>
        <div class="modal-body">
            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}

              <div class="form-group">
                  <label class="form_biblo" >descripcion:</label>
                  <div>
                    {{ form.description }}
                  </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">elija un archivo:</label>
                <div style="margin-left: 3%;">
                  {{form.document}}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">titulo:</label>
                <div>
                  {{ form.title}}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">Tipo de archivo:</label>
                <div>
                  {{ form.tipo}}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">Autor:</label>
                <div>
                  {{ form.autor}}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">Editorial:</label>
                <div>
                  {{ form.editorial}}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">fecha de salida:</label>
                <div>
                  {{ form.fecha_lanzamiento}}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">cantidad de paginas:</label>
                <div style="margin-left: 3%;" >
                  {{ form.cantidad_paginas }}
                </div>
              </div>


              <div class="form-group">
                <label class="form_biblo">genero:</label>
                <div>
                  {{ form.genero}}
                </div>
              </div>
            </div>
            <!-- Modal footer -->
            <hr>
              <button class="btn btn-success" align="center" type="submit">Cargar</button>
        </form>
      </div>
    </div>
</div>

      <div class="modal fade" id="modal_info">
        <div class="modal-dialog">
          <div class="modal-content">
            <div id="datos_modal">
          </div>
        </div>
      </div>
    </div>

</div>

</body>

<script>

function sortTable(n) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById("mytable");
  switching = true;
  //Set the sorting direction to ascending:
  dir = "asc";
  /*Make a loop that will continue until
  no switching has been done:*/
  while (switching) {
    //start by saying: no switching is done:
    switching = false;
    rows = table.getElementsByTagName("TR");
    /*Loop through all table rows (except the
    first, which contains table headers):*/
    for (i = 1; i < (rows.length - 1); i++) {
      //start by saying there should be no switching:
      shouldSwitch = false;
      /*Get the two elements you want to compare,
      one from current row and one from the next:*/
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      /*check if the two rows should switch place,
      based on the direction, asc or desc:*/
      if (dir == "asc") {
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          //if so, mark as a switch and break the loop:
          shouldSwitch= true;
          break;
        }
      } else if (dir == "desc") {
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          //if so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      }
    }
    if (shouldSwitch) {
      /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      //Each time a switch is done, increase this count by 1:
      switchcount ++;
    } else {
      /*If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again.*/
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}

function myFunction() {
  var e = document.getElementById("filter_by");
  var strUser = e.options[e.selectedIndex].value;
  var input, filter, table, tr, td, i;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("mytable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[strUser];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function updateDiv()
{
  $( "#mytable" ).load(window.location.href + " #mytable" );
}

function eliminar_libro(url, alum) {
  var r = confirm("Eliminar Libro ?");
  if (r == true) {
    $.ajax({
      method: "POST",
      url: url,
      data: {
        csrfmiddlewaretoken: '{{ csrf_token }}'
      }
    })
    .done(function (data) {
      alert(data.estado);
      updateDiv();
    });
  } else {
    return;
  }

};

function info_libro(url, alum) {
    $.ajax({
        method: "POST",
        url: url,
        data: {
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
    })
    .done(function (data) {
        $("#datos_modal").html(data);
        $("#modal_info").modal();
    });
};

</script>



</html>
{% endblock body %}
