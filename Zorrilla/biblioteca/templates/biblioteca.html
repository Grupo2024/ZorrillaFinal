{% extends 'base.html' %}
{% load static %}
{% block navbar %}
{% endblock navbar %}
{% block body %}

<style>

#snackbar {
    visibility: hidden;
    min-width: 250px;
    margin-left: -110px;
    background-color: #0099cc;
    color: #fff;
    text-align: center;
    border-radius: 2px;
    padding: 16px;
    position: fixed;
    z-index: 1;
    left: 50%;
    bottom: 30px;
    font-size: 17px;
}
    
#snackbar.show {
    visibility: visible;
    -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@-webkit-keyframes fadein {
    from {bottom: 0; opacity: 0;} 
    to {bottom: 30px; opacity: 1;}
}

@keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
}

@-webkit-keyframes fadeout {
    from {bottom: 30px; opacity: 1;} 
    to {bottom: 0; opacity: 0;}
}

@keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 0; opacity: 0;}
}

</style>

<div class="sidenav">
    <h1 align="center" class="text-white">Indice</h1>
  
    <button class="dropdown-btn">Alfabeticamente<i class="fa fa-caret-down"></i></button>
    <div class="dropdown-container">
      <a href="#">5 libros</a>
      <a href="#">10 libros</a>
      <a href="#">25 libros</a>
      <a href="#">50 libros</a>
      <a href="#">100 libros</a>
    </div>
    <button class="dropdown-btn">Autor<i class="fa fa-caret-down"></i></button>
    <div class="dropdown-container">
      <a href="#">5 libros</a>
      <a href="#">10 libros</a>
      <a href="#">25 libros</a>
      <a href="#">50 libros</a>
      <a href="#">100 libros</a>
    </div>
    <button class="dropdown-btn">Fecha de lanzamiento<i class="fa fa-caret-down"></i></button>
    <div class="dropdown-container">
      <a href="#">5 libros</a>
      <a href="#">10 libros</a>
      <a href="#">25 libros</a>
      <a href="#">50 libros</a>
      <a href="#">100 libros</a>
    </div>
    <button class="dropdown-btn">Genero<i class="fa fa-caret-down"></i></button>
    <div class="dropdown-container">
      <a href="#">5 libros</a>
      <a href="#">10 libros</a>
      <a href="#">25 libros</a>
      <a href="#">50 libros</a>
      <a href="#">100 libros</a>
    </div>
    <button class="dropdown-btn">Habilitado<i class="fa fa-caret-down"></i></button>
    <div class="dropdown-container">
      <a href="#">5 libros</a>
      <a href="#">10 libros</a>
      <a href="#">25 libros</a>
      <a href="#">50 libros</a>
      <a href="#">100 libros</a>
    </div>
    <a href="#todos">Todos</a>
  </div>
  
  
  
<div class="main">

    <br>
    <center><h2>BIBLIOTECA</h2></center>
    <br><br>
  <div class="container">
    <div class="row">
      <div class="">
        <input type="text"placeholder="Nombre del libro que desee buscar" id="myInput" onkeyup="myFunction()">
        <select id="filter_by">
            <option value=0>Libro</option>
            <option value=1>Descripción</option>
            <option value=2>Fecha</option>
        </select>
        </div>
        <a class="btn btn-success" data-toggle="modal" data-target="#myModal" >Añadir libro</a>
        
    </div>
  </div>
  <div class="container">
      <div class="row">
          <div class="col-md-12">
          <h4></h4>
          <div class="table-responsive">


  <table id="mytable" class="table table-hover">

        <thead>
          <th onclick="sortTable(0)">Libro</th>
          <th onclick="sortTable(1)">Descripción</th>
          <th onclick="sortTable(2)">Fecha</th>
          <th>Info</th>
          <th>Borrar</th>
          <th>Ver Libro</th>
        </thead>
        <tbody>
          {% for doc in documentos %}
              <tr>
              <td>{{doc.title}}</td>
              <td>{{doc.description}}</td>
              <td>{{doc.uploaded_at}}</td>
              <td><button class="btn btn-info" onclick="info_libro('{% url 'info_libro' doc.id %}', {{doc.id}})" id="info_book">
                <i style="font-size:15px" class="fa">&#xf013;</i></button></td>

              <td><button class="btn btn-danger" onclick="eliminar_libro('{% url 'eliminar_libro' doc.id %}', {{doc.id}})" id="delete_book">
                <i style="font-size:15px" class="fa">&#xf00d;</i></button></td>

              <td><a type="button" class="btn btn-outline-primary" href="{{ doc.document.url }}">Abrir</a></td>
              </tr>

          {% endfor %}
      </tbody>

  </table>
              
      <div id="snackbar"><span id="span_result"></span></div>
              
  <!-- The Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="font-weight-bold" id="Heading">Cargar Libro</h4>            
            <button type="button" class="close" data-dismiss="modal">X</button>
          </div>
          <div class="modal-body">
              <form method="post" enctype="multipart/form-data" id="form_for_book">
                {% csrf_token %}

                <div class="form-group">
                    <label class="form_biblo" >Descripcion:</label>
                    <div>
                      {{ form.description }}
                    </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Elija un archivo:</label>
                  <div style="margin-left: 3%;">
                      {{form.document}}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Titulo:</label>
                  <div>
                    {{ form.title}}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Tipo de archivo:</label>
                  <div>
                    {{ form.tipo}}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Autor:</label>
                  <div>
                    {{ form.autor}}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Editorial:</label>
                  <div>
                    {{ form.editorial}}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Fecha de salida:</label>
                  <div>
                      {{ form.fecha_lanzamiento}}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">Cantidad de paginas:</label>
                  <div style="margin-left: 3%;" >
                    {{ form.cantidad_paginas }}
                  </div>
                </div>


                <div class="form-group">
                  <label class="form_biblo">genero:</label>
                  <div>
                    {{ form.genero}}
                  </div>
                </div>
              <!-- Modal footer -->
              <hr>
              </form>
                
                <button class="btn btn-success" align="center" onclick="load_book()">Cargar</button>
                  <span id="estado" style="color:red"></span>
            </div>
      </div>
  </div>

        <div class="modal fade" id="modal_info">
          <div class="modal-dialog">
            <div class="modal-content">
              <div id="datos_modal">
            </div>
          </div>
        </div>
      </div>

  </div>
</div>


<script>
    
    function updateDiv()
    {
      $( "#mytable" ).load(window.location.href + " #mytable" );
    }
    
    function reload_modal()
    {
      $( "#myModal" ).load(window.location.href + " #myModal" );
    }
    
    function load_book(){
        var myForm = document.getElementById('form_for_book');
        formData = new FormData(myForm);
        $.ajax({
            url: 'cargado/',
            data: formData,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function(data){
                console.log(data.error);
                if (data.error){
                    var x = document.getElementById("estado");
                    estado.innerHTML = data.estado
                }else{
                    var x = document.getElementById("myModal");
                    $(x).modal('hide');
                    updateDiv();
                    reload_modal();
                    var y = document.getElementById("snackbar");
                    y.className = "show";
                    document.getElementById("span_result").innerHTML = data.estado;
                    setTimeout(function(){ y.className = y.className.replace("show", ""); }, 2000);
                }
            }
        });
    }
    
function sortTable(n) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById("mytable");
  switching = true;
  //Set the sorting direction to ascending:
  dir = "asc";
  /*Make a loop that will continue until
  no switching has been done:*/
  while (switching) {
    //start by saying: no switching is done:
    switching = false;
    rows = table.getElementsByTagName("TR");
    /*Loop through all table rows (except the
    first, which contains table headers):*/
    for (i = 1; i < (rows.length - 1); i++) {
      //start by saying there should be no switching:
      shouldSwitch = false;
      /*Get the two elements you want to compare,
      one from current row and one from the next:*/
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      /*check if the two rows should switch place,
      based on the direction, asc or desc:*/
      if (dir == "asc") {
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          //if so, mark as a switch and break the loop:
          shouldSwitch= true;
          break;
        }
      } else if (dir == "desc") {
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          //if so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      }
    }
    if (shouldSwitch) {
      /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      //Each time a switch is done, increase this count by 1:
      switchcount ++;
    } else {
      /*If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again.*/
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}

function myFunction() {
  var e = document.getElementById("filter_by");
  var strUser = e.options[e.selectedIndex].value;
  var input, filter, table, tr, td, i;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("mytable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[strUser];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}



function eliminar_libro(url, alum) {
  var r = confirm("Eliminar Libro ?");
  if (r == true) {
    $.ajax({
      method: "POST",
      url: url,
      data: {
        csrfmiddlewaretoken: '{{ csrf_token }}'
      }
    })
    .done(function (data) {
      var y = document.getElementById("snackbar");
      y.className = "show";
      document.getElementById("span_result").innerHTML = data.estado;
      setTimeout(function(){ y.className = y.className.replace("show", ""); }, 2000);
      updateDiv();
    });
  } else {
    return;
  }

};

function info_libro(url, alum) {
    $.ajax({
        method: "POST",
        url: url,
        data: {
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
    })
    .done(function (data) {
        $("#datos_modal").html(data);
        $("#modal_info").modal();
    });
};

/* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
var dropdown = document.getElementsByClassName("dropdown-btn");
var i;
for (i = 0; i < dropdown.length; i++) {
  dropdown[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var dropdownContent = this.nextElementSibling;
    if (dropdownContent.style.display === "block") {
      dropdownContent.style.display = "none";
    } else {
      dropdownContent.style.display = "block";
    }
  });
}

</script>



</html>
{% endblock body %}
