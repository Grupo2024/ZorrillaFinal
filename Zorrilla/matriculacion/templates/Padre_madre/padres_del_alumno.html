{% extends 'base.html' %}
{% load static %}
{% block navbar %}
{% endblock navbar %}
{% block body %}

<br>
<h3><center>Padres de {{alumno.apellido}} {{alumno.nombre}}.</center></h3>
<br>
<table style="width:50%" align="center">
    <tr>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Dni</th>
        <th>Email</th>
        <th>Asignado Por</th>
        <th>Fecha de Asignacion</th>
        <th>Desvincular</th>
    </tr>
    {% for a in familiares %}
    <tr>
        <td>{{a.padre_madre.nombre|title}}</td>
        <td>{{a.padre_madre.apellido|title}}</td>
        <td>{{a.padre_madre.dni}}</td>
        <td>{{a.padre_madre.email}}</td>
        <td>{{a.secretaria.nombre_t|title}}</td>
        <td>{{a.fecha_relacion|date:"d/M/Y"}}</td>
        <td><a onclick="desvincular({{a.padre_madre.dni}})"><i style="font-size:15px" class="fa fa-info-circle"></i></a></td>
    </tr>
    {% endfor %}
</table>

<form id="desvincular_familiar" method="post" action="{% url 'desvincular_familiar' %}">
    {% csrf_token %}
    <input type="hidden" value="{{alumno.dni}}" name="dni_alumno">
    <input type="hidden" value=0 name="dni_padre" id="dni_padre">
</form>

<button onclick="traer_padres('{% url 'todos_los_padres' alumno.dni %}')">Añadir Padre</button>

<div class="modal fade" id="todos_los_padres">
    <div class="modal-dialog modal-lg">
        <div id="datos_padre">
        </div>
    </div>
</div>

<script>

    function desvincular(dni_padre){
        if (confirm("¿Desvincular a este Padre ?")) {
            document.getElementById("dni_padre").value = dni_padre;
            var des = document.getElementById("desvincular_familiar");
            des.submit();
        } else {
            return;
        }
    }

    function traer_padres(url){
        $.ajax({
            method: "POST",
            url: url,
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }
        })
            .done(function (data) {
            $("#datos_padre").html(data);
            $('#todos_los_padres').modal('show');
        });
    }

    $('input[name=padre]').click(function() {
        var aux2 = $('input[name=padre]:checked').val();
        document.getElementById("dni_padre").value = aux2;
    });


</script>

{% endblock body %}
